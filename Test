--- Load Mercury UI Library
local Mercury = loadstring(game:HttpGet("https://raw.githubusercontent.com/deeeity/mercury-lib/master/src.lua"))()

-- Services
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- === Save / Load Settings ===
local settingsFolder = player:FindFirstChild("MercurySettings") or Instance.new("Folder")
settingsFolder.Name = "MercurySettings"
settingsFolder.Parent = player

-- Save toggle state function
local function saveToggleState(name, state)
    local toggleValue = settingsFolder:FindFirstChild(name)
    if not toggleValue then
        toggleValue = Instance.new("BoolValue")
        toggleValue.Name = name
        toggleValue.Parent = settingsFolder
    end
    toggleValue.Value = state
end

-- Load toggle state function
local function loadToggleState(name)
    local toggleValue = settingsFolder:FindFirstChild(name)
    if toggleValue then
        return toggleValue.Value
    else
        return false
    end
end

-- Create GUI
local GUI = Mercury:Create{
    Name = "Mainland Attach GUI",
    Theme = Mercury.Themes.Dark,
    Link = "https://github.com/deeeity/mercury-lib"
}

local MainTab = GUI:Tab{
    Name = "Main",
    Icon = "rbxassetid://8569322835"
}

-- === Universal Exclusions ===
local exclusions = {
    ["{84b93b68-b932-4db8-b765-d1bd9ef8aae9}"] = true,
    ["{c5769905-aecf-4d7a-ada9-064802b0cae9}"] = true,
    ["{d2227f02-c482-4911-b201-7e842b31c47c}"] = true,
    ["{6b019e60-21c6-4536-9a06-4cbfee80d88f}"] = true,
    ["{12916ad6-7fd9-46d5-8bc1-e69671249721}"] = true,
    ["{2c0549c7-f2d0-4828-bc2a-6d484e792cdd}"] = true,
    ["{de31ac95-029b-4c26-b9f8-4b61faed7335}"] = true,
    ["{fd489389-537f-40e1-bd1a-c048522d23bc}"] = true,
    ["{f1f04024-ba69-4d0f-9fee-4f93758c1bfc}"] = true,
    ["Horse"] = true,
    ["Travel Boat"] = true,
    ["c21e5cba-8957-4d65-9e54-1aaa2411a71c"] = true,
}

-- Toggle: Attach to Body with saved settings
local attached = false
local weld

MainTab:Toggle{
    Name = "Attach to Body",
    StartingState = loadToggleState("AttachToBody"), -- Load saved state
    Description = "Attach to one Body at a time until it disappears",
    Callback = function(state)
        attached = state
        saveToggleState("AttachToBody", state) -- Save toggle state

        if attached then
            spawn(function()
                local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if not hrp then return end

                local mainland = workspace:FindFirstChild("Islands") and workspace.Islands:FindFirstChild("Mainland")
                if not mainland then return end

                for _, model in pairs(mainland:GetChildren()) do
                    if attached and not exclusions[model.Name] then
                        local body = model:FindFirstChild("Body")
                        if body and body.Parent then
                            -- Create Weld
                            weld = Instance.new("WeldConstraint")
                            weld.Part0 = hrp
                            weld.Part1 = body
                            weld.Parent = hrp

                            repeat
                                wait(0.3)
                            until not body or not body.Parent or not attached

                            -- Remove Weld
                            if weld then
                                weld:Destroy()
                                weld = nil
                            end
                        end
                    end
                end
            end)
        else
            if weld then
                weld:Destroy()
                weld = nil
            end
        end
    end
}
